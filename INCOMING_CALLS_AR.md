# ๐ ุชุญุฏูุซ: ุฅุดุนุงุฑุงุช ุงูููุงููุงุช ุงููุงุฑุฏุฉ

## โ ุชู ุงูุฅุตูุงุญ!

### ุงููุดููุฉ ุงูุณุงุจูุฉ
- ุนูุฏ ุจุฏุก ููุงููุฉุ ุงููุชุตู ูุฑู "Call in progress"
- ุงูุทุฑู ุงูุขุฎุฑ ูุง ูุชููู ุฃู ุฅุดุนุงุฑ ุจุงูููุงููุฉ ุงููุงุฑุฏุฉ
- ูุง ุชูุฌุฏ ุทุฑููุฉ ููุฑุฏ ุนูู ุงูููุงููุฉ

### ุงูุญู ุงูุฌุฏูุฏ

#### 1. ุฅุถุงูุฉ ูุธุงู ุฅุดุนุงุฑุงุช WebSocket

**ูู Backend (consumers.py):**
- โ ุฅุถุงูุฉ ูุนุงูุฌ `incoming_call` ูู ChatConsumer
- โ ุฅุฑุณุงู ุฅุดุนุงุฑ ููุทุฑู ุงูุขุฎุฑ ุนุจุฑ WebSocket
- โ ุชูุฑูุฑ ูุนูููุงุช ุงููุชุตู (ุงุณู ุงููุณุชุฎุฏูุ ูุนุฑู ุงูููุงููุฉ)

**ูู Frontend (chat.js):**
- โ ุงุณุชูุจุงู ุฅุดุนุงุฑ ุงูููุงููุฉ ุงููุงุฑุฏุฉ
- โ ุนุฑุถ ูุงุฌูุฉ ููุงููุฉ ูุงุฑุฏุฉ ุฌูููุฉ
- โ ุฃุฒุฑุงุฑ ูุจูู/ุฑูุถ ุงูููุงููุฉ
- โ ุฑุจุท ูุจูู ุงูููุงููุฉ ุจู WebRTC

---

## ููู ูุนูู ุงูุขู

### ุณููุงุฑูู ุงูููุงููุฉ ุงููุงูู

#### ุงููุชุตู (Caller):
```
1. ูุถุบุท ุฒุฑ "๐ Call"
2. ูุธูุฑ "Calling..."
3. ูุชู ุฅูุดุงุก ุณุฌู ุงูููุงููุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
4. ูุชู ุฅุฑุณุงู ุฅุดุนุงุฑ ุนุจุฑ WebSocket ููุทุฑู ุงูุขุฎุฑ
5. ูุจุฏุฃ WebRTC connection
6. ูุธูุฑ "Call in progress..."
```

#### ุงููุณุชูุจู (Receiver):
```
1. ูุชููู ุฅุดุนุงุฑ WebSocket
2. ุชุธูุฑ ูุงูุฐุฉ ููุจุซูุฉ ุฎุถุฑุงุก ุฌูููุฉ:
   ๐
   [ุงุณู ุงููุชุตู]
   is calling you...
   [โ Accept] [โ Reject]
3. ุนูุฏ ุงูุถุบุท ุนูู Accept:
   - ูุทูุจ ุฅุฐู ุงููููุฑูููู
   - ูุจุฏุฃ WebRTC connection
   - ุชุจุฏุฃ ุงูููุงููุฉ!
4. ุนูุฏ ุงูุถุบุท ุนูู Reject:
   - ุชุฎุชูู ุงููุงูุฐุฉ
   - ูุชู ุฅูุบุงุก ุงูููุงููุฉ
```

---

## ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ

### 1. ูุงุฌูุฉ ููุงููุฉ ูุงุฑุฏุฉ ุฌูููุฉ
```css
- ุฎูููุฉ ุฎุถุฑุงุก ูุชุฏุฑุฌุฉ
- ุฃููููุฉ ูุงุชู ูุชุญุฑูุฉ (bounce animation)
- ุงุณู ุงููุชุตู ูุงุถุญ
- ุฒุฑูู ูุจูุฑูู: ูุจูู/ุฑูุถ
- ุชุฃุซูุฑ popIn ุนูุฏ ุงูุธููุฑ
```

### 2. ุงูุชูุงุตู ุนุจุฑ WebSocket
```javascript
// ุงููุชุตู ูุฑุณู:
{
    type: 'incoming_call',
    call_id: 123,
    caller_username: 'ahmed'
}

// ุงููุณุชูุจู ูุณุชูุจู ููุนุฑุถ ุงููุงุฌูุฉ
```

### 3. ุฏูุงู ุฌุฏูุฏุฉ

**handleIncomingCall(data)**
- ุชุนุฑุถ ูุงุฌูุฉ ุงูููุงููุฉ ุงููุงุฑุฏุฉ
- ุชูุฑุฑ ูุนูููุงุช ุงููุชุตู

**acceptCall(callId)**
- ุชุฎูู ูุงุฌูุฉ ุงูููุงููุฉ ุงููุงุฑุฏุฉ
- ุชุจุฏุฃ WebRTC connection
- ุชุนุฑุถ ูุงุฌูุฉ "Connecting..."

**rejectCall(callId)**
- ุชุฎูู ูุงุฌูุฉ ุงูููุงููุฉ ุงููุงุฑุฏุฉ
- ุชูุบู ุงูููุงููุฉ

---

## ุงุฎุชุจุงุฑ ุงูููุงููุงุช

### ุฎุทูุงุช ุงูุงุฎุชุจุงุฑ ุงููุงููุฉ

#### 1. ุงูุชุญ ูุงูุฐุชูู
```
ูุงูุฐุฉ 1: ุชุณุฌูู ุฏุฎูู ูู "ahmed"
ูุงูุฐุฉ 2: ุชุณุฌูู ุฏุฎูู ูู "sara"
```

#### 2. ุงุจุฏุฃ ูุญุงุฏุซุฉ
```
ahmed: ุงุฐูุจ ุฅูู ุงูุฏุฑุฏุดุฉ ูุน sara
```

#### 3. ุงุจุฏุฃ ุงูููุงููุฉ
```
ahmed: ุงุถุบุท "๐ Call"
ุงููุชุตูุญ: ุงุทูุจ ุฅุฐู ุงููููุฑูููู โ ุงุณูุญ
ahmed ูุฑู: "Calling..." ุซู "Call in progress..."
```

#### 4. ุงุณุชูุจู ุงูููุงููุฉ
```
sara: ุชุธูุฑ ูุงูุฐุฉ ููุจุซูุฉ:
      ๐
      ahmed
      is calling you...
      [โ Accept] [โ Reject]

sara: ุงุถุบุท "โ Accept"
ุงููุชุตูุญ: ุงุทูุจ ุฅุฐู ุงููููุฑูููู โ ุงุณูุญ
sara ุชุฑู: "Connecting..." ุซู "Call in progress..."
```

#### 5. ุชุญุฏุซ!
```
โ ุงูุขู ูููู ูู ahmed ู sara ุงูุชุญุฏุซ ูุนุงู
```

#### 6. ุฃููู ุงูููุงููุฉ
```
ุฃู ุทุฑู: ุงุถุบุท "End Call"
โ ุชูุชูู ุงูููุงููุฉ ููุทุฑููู
```

---

## ุงูููุฏ ุงููุถุงู

### Backend (consumers.py)

```python
# ูู ChatConsumer.receive()
elif message_type == 'incoming_call':
    await self.channel_layer.group_send(
        self.room_group_name,
        {
            'type': 'incoming_call_notification',
            'call_id': data.get('call_id'),
            'caller_id': self.user.id,
            'caller_username': self.user.username
        }
    )

# ูุนุงูุฌ ุฌุฏูุฏ
async def incoming_call_notification(self, event):
    if event['caller_id'] != self.user.id:
        await self.send(text_data=json.dumps({
            'type': 'incoming_call',
            'call_id': event['call_id'],
            'caller_id': event['caller_id'],
            'caller_username': event['caller_username']
        }))
```

### Frontend (chat.js)

```javascript
// ูู chatSocket.onmessage
else if (data.type === 'incoming_call') {
    handleIncomingCall(data);
}

// ูู initiateCall()
// ุฅุฑุณุงู ุฅุดุนุงุฑ ุนุจุฑ WebSocket
if (chatSocket && chatSocket.readyState === WebSocket.OPEN) {
    chatSocket.send(JSON.stringify({
        'type': 'incoming_call',
        'call_id': data.call_id
    }));
}

// ุฏูุงู ุฌุฏูุฏุฉ
function handleIncomingCall(data) { ... }
function acceptCall(callId) { ... }
function rejectCall(callId) { ... }
```

---

## โ ุงูุญุงูุฉ ุงูุญุงููุฉ

ุฌููุน ููุฒุงุช ุงูููุงููุงุช ุชุนูู ุงูุขู:
- โ ุจุฏุก ุงูููุงููุฉ
- โ ุฅุดุนุงุฑ ุงููุณุชูุจู
- โ ูุจูู/ุฑูุถ ุงูููุงููุฉ
- โ WebRTC connection
- โ ููู ุงูุตูุช
- โ ุฅููุงุก ุงูููุงููุฉ
- โ ูุงุฌูุงุช ูุณุชุฎุฏู ุฌูููุฉ

**ุฌุงูุฒ ููุงุณุชุฎุฏุงู!** ๐๐
